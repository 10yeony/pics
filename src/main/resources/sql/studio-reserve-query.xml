<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<!-- 예약 Flow 정리 
		1. 해당 스튜디오의 예약 관련 정보 불러오기 (예약 가능 일자 >> 캘린더 표시, )
		2. 
	-->
	
<!-- ================== 예약 모달 창================== -->	
<mapper namespace="StudioInfoMapper">			
	<resultMap type="Reservation" id="ReservationRM">
		<result column="res_id" property="resId"/>
		<result column="cust_id" property="stuId"/>
		<result column="stu_id" property="startDate"/>
		<result column="score" property="endDate"/>
		<result column="content" property="totalPrice"/>
		<result column="img" property="totalPeople"/>
<!-- 		<association property="Customer" javaType="customer">
			<id column="std_id" property="stdId"/>
				<result property="imgSrc" column="img_src" />
		</association> -->
 	</resultMap>

	<select id="getStudioInfo" parameterType="int" resultMap="studioInfoRM">							
		SELECT 		
		<!-- (SELECT -1 FROM studio WHERE s.stu_id=${value}) -->				
		s.stu_id,s.com_id,s.category_id,s.name,s.description,s.rule,
		ctg.category_id,ctg.category_name,
		com.name,com.logo_img,
		sf.size,sf.options,sf.parking,sf.unit_price,sf.default_capacity,sf.excharge,
		t.tag_id,t.tag
		FROM studio 
		LEFT JOIN studio_category ctg ON s.category_id=ctg.category_id
		LEFT JOIN company com ON s.com_id=com.com_id
		LEFT JOIN studio_filter sf ON s.stu_id=sf.stu_id
		LEFT JOIN tag t ON s.stu_id=t.stu_id
		<if test="'${value}'!=null">
		WHERE s.stu_id=${value};
		</if>
	</select>							

 	<select id="getStudioReviews" parameterType="int" resultMap="reviewRM">
		SELECT
		re.review_id, re.cust_id, re.stu_id, re.content, re.img, re.reg_date, re.answer
		FROM review re
		<if test="'${value}'!=null">
		WHERE re.stu_Id=${value}
		</if>
	</select>

	<select id="getAccCustomer" parameterType="int" resultType="int">							
		SELECT count(res.res_id)
		FROM reservation res
		GROUP BY res.stu_id
		<if test="'${value}'!=null">
			HAVING res.stu_id=${value};	
		</if>
	</select>		
	
	<select id="getTags" parameterType="int" resultType="tag">							
		SELECT t.tag
		FROM tag t
		<if test="'${value}'!=null">
		WHERE stu_id=${value}	
		</if>
	</select>
	
	<select id="getBookmark" parameterType="list" resultType="int">
		SELECT b.book_id
		FROM bookmark b
		WHERE b.cust_id = ${list[0]}
		AND b.stu_id = ${list[1]}
	</select>
</mapper>	

	<!-- ================== 스튜디오 공간 등록 관련 쿼리 ======================== 
<mapper namespace="StudioInfoMapper">
	<insert id="registerStudioInfo" parameterType="studio">
		INSERT 
		INTO studio (com_id, category_id, name, description, rule, main_img, port_img, cad_img, floor) 
		VALUES(#{comId}, #{categoryId}, #{name}, #{description}, #{rule}, #{mainImg}, #{portImg}, #{cadImg}, #{floor});
	</insert>
	<select id="getStudioId" parameterType="studio" resultType="int">
		SELECT stu_id FROM studio WHERE name = #{name};
	</select>
	<select id="getCategoryId" parameterType="category" resultType="int">
		SELECT category_id AS categoryId FROM studio_category WHERE category_name = #{categoryName} 	
	</select>																		
</mapper>	

 -->

